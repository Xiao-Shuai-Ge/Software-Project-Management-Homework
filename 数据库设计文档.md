# 教学工作量管理系统 - 数据库设计文档

## 1. 引言

### 1.1 编写目的
本文档旨在详细描述“教学工作量管理系统”的数据库设计方案。通过对系统数据的逻辑结构和物理结构进行设计，为系统的开发、测试和维护提供基础依据。

### 1.2 项目背景
本系统旨在解决高校教学工作量统计过程中的手工操作繁琐、易出错、审核流程不透明等问题。系统通过信息化手段实现工作量的自动计算、多级审核和统计查询。

### 1.3 术语定义
- **SRS**: 需求规格说明书 (Software Requirements Specification)
- **ERD**: 实体关系图 (Entity Relationship Diagram)
- **PK**: 主键 (Primary Key)
- **FK**: 外键 (Foreign Key)

---

## 2. 数据库环境说明

- **数据库类型**: MySQL 8.0+
- **存储引擎**: InnoDB (支持事务，保证数据一致性)
- **字符集**: utf8mb4 (支持全字符集)
- **排序规则**: utf8mb4_general_ci

---

## 3. 概念设计

### 3.1 实体关系图 (ERD) 描述
系统中主要包含以下实体及其关系：
1. **用户 (User)**: 系统参与者，包括教师、院系管理员、系统管理员。
2. **工作量记录 (Workload Record)**: 教师录入的单条教学任务信息。
3. **工作量标准 (Workload Standard)**: 预设的各类课程计算系数。
4. **审核日志 (Audit Log)**: 记录审核操作的历史信息。

**实体间关系：**
- 一个**用户**可以提交多条**工作量记录** (1:N)。
- 一个**用户**可以审核多条**工作量记录**，并产生多条**审核日志** (1:N)。
- 一条**工作量记录**对应多条**审核日志** (1:N)。
- 一条**工作量记录**的计算依赖于**工作量标准**。

---

## 4. 逻辑设计

### 4.1 数据库表结构

#### 4.1.1 用户表 (users)
存储系统的用户信息及权限。

| 字段名 | 数据类型 | 长度 | 约束 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| user_id | INT | 11 | PK, AUTO_INC | 用户唯一标识 |
| username | VARCHAR | 50 | UNIQUE, NOT NULL | 登录账号 (工号/手机号) |
| password | VARCHAR | 255 | NOT NULL | 加密后的密码 |
| real_name | VARCHAR | 50 | NOT NULL | 真实姓名 |
| department | VARCHAR | 100 | - | 所属院系 |
| role | TINYINT | 1 | DEFAULT 0 | 角色: 0-教师, 1-院系管理员, 2-系统管理员 |
| created_at | DATETIME | - | DEFAULT NOW() | 创建时间 |

#### 4.1.2 工作量记录表 (workload_records)
存储教师提交的原始数据及计算后的结果。

| 字段名 | 数据类型 | 长度 | 约束 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| record_id | INT | 11 | PK, AUTO_INC | 记录唯一标识 |
| teacher_id | INT | 11 | FK (users.user_id) | 教师ID |
| course_name | VARCHAR | 100 | NOT NULL | 课程名称 |
| course_type | VARCHAR | 50 | NOT NULL | 课程类型 (如：理论课、实验课、毕设指导) |
| student_count | INT | 11 | NOT NULL | 学生人数 |
| class_hours | DECIMAL | 10,2 | NOT NULL | 额定课时 |
| workload | DECIMAL | 10,2 | - | 计算后的总工作量 |
| academic_year | VARCHAR | 20 | NOT NULL | 学年 (如：2024-2025) |
| semester | TINYINT | 1 | NOT NULL | 学期 (1-第一学期, 2-第二学期) |
| status | TINYINT | 1 | DEFAULT 0 | 状态: 0-待审核, 1-审核通过, 2-驳回 |
| updated_at | DATETIME | - | DEFAULT NOW() | 最后更新时间 |

#### 4.1.3 工作量标准表 (workload_standards)
存储不同课程类型的计算系数，便于动态调整。

| 字段名 | 数据类型 | 长度 | 约束 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| std_id | INT | 11 | PK, AUTO_INC | 标准唯一标识 |
| course_type | VARCHAR | 50 | UNIQUE, NOT NULL | 课程类型名称 |
| coefficient | DECIMAL | 5,2 | NOT NULL | 计算系数 (如：1.2, 1.0) |
| description | VARCHAR | 255 | - | 标准说明 |

#### 4.1.4 审核日志表 (audit_logs)
记录每一次审核操作的细节。

| 字段名 | 数据类型 | 长度 | 约束 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| log_id | INT | 11 | PK, AUTO_INC | 日志唯一标识 |
| record_id | INT | 11 | FK (workload_records.record_id) | 关联的工作量记录 |
| auditor_id | INT | 11 | FK (users.user_id) | 审核人ID |
| audit_status | TINYINT | 1 | NOT NULL | 审核动作 (1-通过, 2-驳回) |
| audit_opinion | TEXT | - | - | 审核意见/备注 |
| audit_time | DATETIME | - | DEFAULT NOW() | 审核时间 |

---

## 5. 物理设计

### 5.1 索引设计
- `users.username`: 唯一索引，提高登录校验效率。
- `workload_records.teacher_id`: 普通索引，提高按教师查询的效率。
- `workload_records.status`: 普通索引，提高审核列表过滤效率。
- `audit_logs.record_id`: 普通索引，提高查询审核历史的效率。

### 5.2 存储策略
- 定期对 `audit_logs` 进行归档，清理一年以上的历史数据。
- 数据库文件存储在高性能 SSD 阵列中。

---

## 6. 安全设计

### 6.1 数据加密
- 用户密码必须使用强散列算法（如 BCrypt 或 Argon2）进行加密存储。
- 敏感数据在传输过程中使用 HTTPS 加密。

### 6.2 备份策略
- **全量备份**: 每周日凌晨 2:00 进行一次物理全量备份。
- **增量备份**: 每日凌晨 3:00 进行逻辑增量备份（binlog 备份）。
- **保留策略**: 备份文件在异地保留至少 30 天。

---

## 7. 维护建议
- 数据库连接池配置建议：初始 10，最大 100。
- 定期分析慢查询日志，针对性优化 SQL 或增加索引。
- 每年进行一次数据库扩容评估。
